<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPT ç”Ÿæˆå™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .toolbar {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e9ecef;
            color: #495057;
        }

        .btn-secondary:hover {
            background: #dee2e6;
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(17, 153, 142, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .editor-container {
            display: flex;
            height: 500px;
        }

        .editor-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .editor-section:first-child {
            border-right: 1px solid #e9ecef;
        }

        .section-header {
            background: #f8f9fa;
            padding: 12px 20px;
            font-weight: 600;
            color: #495057;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header span {
            font-size: 12px;
            color: #6c757d;
            font-weight: normal;
        }

        textarea {
            flex: 1;
            border: none;
            padding: 20px;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 13px;
            line-height: 1.6;
            resize: none;
            outline: none;
        }

        textarea:focus {
            background: #fefefe;
        }

        .preview-section {
            background: #1e1e1e;
            color: #d4d4d4;
            overflow: auto;
        }

        .preview-section pre {
            padding: 20px;
            margin: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .status-bar {
            background: #f8f9fa;
            padding: 12px 20px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            color: #6c757d;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #6c757d;
        }

        .status-dot.valid {
            background: #28a745;
        }

        .status-dot.invalid {
            background: #dc3545;
        }

        .status-dot.processing {
            background: #ffc107;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .toast.error {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }

        .toast.info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .modal p {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .template-list {
            display: grid;
            gap: 10px;
            margin-bottom: 20px;
        }

        .template-item {
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .template-item:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        .template-item h4 {
            font-size: 14px;
            margin-bottom: 4px;
            color: #333;
        }

        .template-item p {
            font-size: 12px;
            color: #666;
            margin: 0;
        }

        .help-section {
            background: #f0f4ff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .help-section h4 {
            font-size: 14px;
            color: #667eea;
            margin-bottom: 8px;
        }

        .help-section ul {
            font-size: 12px;
            color: #555;
            padding-left: 20px;
        }

        .help-section li {
            margin-bottom: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š PPT ç”Ÿæˆå™¨</h1>
            <p>ç²˜è´´ JSON ç»“æ„æ•°æ®ï¼Œä¸€é”®ç”Ÿæˆ PowerPoint æ¼”ç¤ºæ–‡ç¨¿</p>
        </div>

        <div class="main-card">
            <div class="toolbar">
                <button class="btn btn-primary" onclick="generatePPT()">
                    <span>ğŸš€</span> ç”Ÿæˆ PPT
                </button>
                <button class="btn btn-secondary" onclick="validateJSON()">
                    <span>âœ…</span> éªŒè¯ JSON
                </button>
                <button class="btn btn-secondary" onclick="formatJSON()">
                    <span>ğŸ“</span> æ ¼å¼åŒ–
                </button>
                <button class="btn btn-secondary" onclick="showTemplates()">
                    <span>ğŸ“‹</span> ç¤ºä¾‹æ¨¡æ¿
                </button>
                <button class="btn btn-secondary" onclick="clearEditor()">
                    <span>ğŸ—‘ï¸</span> æ¸…ç©º
                </button>
            </div>

            <div class="editor-container">
                <div class="editor-section">
                    <div class="section-header">
                        JSON è¾“å…¥
                        <span id="charCount">0 å­—ç¬¦</span>
                    </div>
                    <textarea 
                        id="jsonInput" 
                        placeholder='åœ¨æ­¤ç²˜è´´ JSON æ•°æ®...

ç¤ºä¾‹æ ¼å¼:
{
  "presentation": {
    "title": "æ¼”ç¤ºæ–‡ç¨¿æ ‡é¢˜",
    "slides": [...]
  }
}'
                        oninput="updatePreview()"
                    ></textarea>
                </div>
                <div class="editor-section preview-section">
                    <div class="section-header" style="background: #252526; color: #d4d4d4; border-bottom-color: #3c3c3c;">
                        è§£æé¢„è§ˆ
                        <span id="slideCount">0 é¡µå¹»ç¯ç‰‡</span>
                    </div>
                    <pre id="preview">ç­‰å¾…è¾“å…¥ JSON æ•°æ®...</pre>
                </div>
            </div>

            <div class="status-bar">
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">å‡†å¤‡å°±ç»ª</span>
                </div>
                <div>
                    <span id="lastAction">PptxGenJS v3.12.0</span>
                </div>
            </div>
        </div>

        <div class="help-section" style="margin-top: 20px; background: rgba(255,255,255,0.95); border-radius: 12px; padding: 20px;">
            <h4>ğŸ“– æ”¯æŒçš„å…ƒç´ ç±»å‹</h4>
            <ul>
                <li><strong>text</strong> - æ–‡æœ¬æ¡†ï¼ˆæ”¯æŒå­—ä½“ã€å¤§å°ã€é¢œè‰²ã€å¯¹é½æ–¹å¼ï¼‰</li>
                <li><strong>image</strong> - å›¾ç‰‡ï¼ˆæ”¯æŒ URL å’Œ Base64ï¼‰</li>
                <li><strong>table</strong> - è¡¨æ ¼ï¼ˆæ”¯æŒè¡¨å¤´ã€åˆå¹¶å•å…ƒæ ¼ï¼‰</li>
                <li><strong>shape</strong> - å½¢çŠ¶ï¼ˆçŸ©å½¢ã€åœ†å½¢ã€ç®­å¤´ç­‰ï¼‰</li>
                <li><strong>chart</strong> - å›¾è¡¨ï¼ˆæŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾ã€é¥¼å›¾ï¼‰</li>
                <li><strong>list</strong> - åˆ—è¡¨ï¼ˆé¡¹ç›®ç¬¦å·ã€ç¼–å·åˆ—è¡¨ï¼‰</li>
            </ul>
        </div>
    </div>

    <!-- Toast é€šçŸ¥ -->
    <div class="toast" id="toast"></div>

    <!-- æ¨¡æ¿é€‰æ‹©å¼¹çª— -->
    <div class="modal-overlay" id="templateModal">
        <div class="modal">
            <h3>ğŸ“‹ é€‰æ‹©ç¤ºä¾‹æ¨¡æ¿</h3>
            <div class="template-list">
                <div class="template-item" onclick="loadTemplate('simple')">
                    <h4>ç®€å•æ–‡æœ¬æ¨¡æ¿</h4>
                    <p>åŒ…å«æ ‡é¢˜å’Œæ–‡æœ¬å†…å®¹çš„åŸºç¡€æ¨¡æ¿</p>
                </div>
                <div class="template-item" onclick="loadTemplate('table')">
                    <h4>æ•°æ®è¡¨æ ¼æ¨¡æ¿</h4>
                    <p>åŒ…å«è¡¨æ ¼å’Œæ•°æ®å±•ç¤ºçš„æ¨¡æ¿</p>
                </div>
                <div class="template-item" onclick="loadTemplate('full')">
                    <h4>å®Œæ•´æ¼”ç¤ºæ¨¡æ¿</h4>
                    <p>å¤šé¡µå¹»ç¯ç‰‡ï¼ŒåŒ…å«å¤šç§å…ƒç´ ç±»å‹</p>
                </div>
                <div class="template-item" onclick="loadTemplate('chart')">
                    <h4>å›¾è¡¨å±•ç¤ºæ¨¡æ¿</h4>
                    <p>åŒ…å«å„ç±»å›¾è¡¨çš„æ•°æ®å¯è§†åŒ–æ¨¡æ¿</p>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        // ===== æ¨¡æ¿æ•°æ® =====
        const templates = {
            simple: {
                presentation: {
                    title: "ç®€å•æ¼”ç¤ºæ–‡ç¨¿",
                    author: "PPTç”Ÿæˆå™¨",
                    theme: {
                        primary_color: "#1a73e8",
                        font_family: "Microsoft YaHei"
                    },
                    slides: [
                        {
                            slide_id: 1,
                            slide_type: "title_slide",
                            background: { type: "color", value: "#ffffff" },
                            elements: [
                                {
                                    element_type: "text",
                                    element_id: "title_001",
                                    position: { x: 0.5, y: 2, width: 9, height: 1.5, unit: "inch" },
                                    content: "æ¬¢è¿ä½¿ç”¨ PPT ç”Ÿæˆå™¨",
                                    style: {
                                        font_size: 44,
                                        font_weight: "bold",
                                        color: "#1a73e8",
                                        text_align: "center"
                                    }
                                },
                                {
                                    element_type: "text",
                                    element_id: "subtitle_001",
                                    position: { x: 0.5, y: 3.5, width: 9, height: 0.8, unit: "inch" },
                                    content: "å¿«é€Ÿå°† JSON æ•°æ®è½¬æ¢ä¸ºä¸“ä¸šæ¼”ç¤ºæ–‡ç¨¿",
                                    style: {
                                        font_size: 24,
                                        color: "#666666",
                                        text_align: "center"
                                    }
                                }
                            ]
                        }
                    ]
                }
            },

            table: {
                presentation: {
                    title: "æ•°æ®æŠ¥è¡¨",
                    slides: [
                        {
                            slide_id: 1,
                            elements: [
                                {
                                    element_type: "text",
                                    position: { x: 0.5, y: 0.3, width: 9, height: 0.8, unit: "inch" },
                                    content: "é”€å”®æ•°æ®ç»Ÿè®¡",
                                    style: { font_size: 32, font_weight: "bold", color: "#333333" }
                                },
                                {
                                    element_type: "table",
                                    position: { x: 0.5, y: 1.2, width: 9, height: 3.5, unit: "inch" },
                                    structure: { rows: 5, columns: 4, has_header: true },
                                    style: {
                                        header_bg_color: "#1a73e8",
                                        header_text_color: "#ffffff",
                                        border_color: "#dddddd",
                                        font_size: 12
                                    },
                                    data: [
                                        { row: 0, is_header: true, cells: [
                                            { col: 0, content: "äº§å“" },
                                            { col: 1, content: "Q1" },
                                            { col: 2, content: "Q2" },
                                            { col: 3, content: "å¢é•¿ç‡" }
                                        ]},
                                        { row: 1, cells: [
                                            { col: 0, content: "äº§å“A" },
                                            { col: 1, content: "Â¥125,000" },
                                            { col: 2, content: "Â¥156,000" },
                                            { col: 3, content: "+24.8%" }
                                        ]},
                                        { row: 2, cells: [
                                            { col: 0, content: "äº§å“B" },
                                            { col: 1, content: "Â¥89,000" },
                                            { col: 2, content: "Â¥112,000" },
                                            { col: 3, content: "+25.8%" }
                                        ]},
                                        { row: 3, cells: [
                                            { col: 0, content: "äº§å“C" },
                                            { col: 1, content: "Â¥203,000" },
                                            { col: 2, content: "Â¥245,000" },
                                            { col: 3, content: "+20.7%" }
                                        ]},
                                        { row: 4, cells: [
                                            { col: 0, content: "åˆè®¡" },
                                            { col: 1, content: "Â¥417,000" },
                                            { col: 2, content: "Â¥513,000" },
                                            { col: 3, content: "+23.0%" }
                                        ]}
                                    ]
                                }
                            ]
                        }
                    ]
                }
            },

            chart: {
                presentation: {
                    title: "æ•°æ®å¯è§†åŒ–æŠ¥å‘Š",
                    slides: [
                        {
                            slide_id: 1,
                            elements: [
                                {
                                    element_type: "text",
                                    position: { x: 0.5, y: 0.3, width: 9, height: 0.6, unit: "inch" },
                                    content: "å¹´åº¦é”€å”®è¶‹åŠ¿åˆ†æ",
                                    style: { font_size: 28, font_weight: "bold", color: "#333" }
                                },
                                {
                                    element_type: "chart",
                                    position: { x: 0.5, y: 1, width: 6, height: 4, unit: "inch" },
                                    chart_type: "bar",
                                    title: "å­£åº¦é”€å”®å¯¹æ¯”",
                                    data: {
                                        labels: ["Q1", "Q2", "Q3", "Q4"],
                                        datasets: [
                                            { label: "2023å¹´", values: [120, 150, 180, 200], color: "#1a73e8" },
                                            { label: "2024å¹´", values: [150, 190, 220, 260], color: "#34a853" }
                                        ]
                                    },
                                    options: { show_legend: true, legend_position: "bottom" }
                                },
                                {
                                    element_type: "list",
                                    position: { x: 6.8, y: 1.2, width: 2.8, height: 3, unit: "inch" },
                                    list_type: "bullet",
                                    items: [
                                        { level: 0, content: "åŒæ¯”å¢é•¿ 25%" },
                                        { level: 0, content: "Q4 è¡¨ç°æœ€ä½³" },
                                        { level: 0, content: "æŒç»­å¢é•¿è¶‹åŠ¿" }
                                    ],
                                    style: { font_size: 14, bullet_color: "#1a73e8" }
                                }
                            ]
                        },
                        {
                            slide_id: 2,
                            elements: [
                                {
                                    element_type: "text",
                                    position: { x: 0.5, y: 0.3, width: 9, height: 0.6, unit: "inch" },
                                    content: "å¸‚åœºä»½é¢åˆ†å¸ƒ",
                                    style: { font_size: 28, font_weight: "bold", color: "#333" }
                                },
                                {
                                    element_type: "chart",
                                    position: { x: 1.5, y: 1.2, width: 5, height: 4, unit: "inch" },
                                    chart_type: "pie",
                                    title: "",
                                    data: {
                                        labels: ["äº§å“A", "äº§å“B", "äº§å“C", "å…¶ä»–"],
                                        datasets: [
                                            { values: [35, 28, 22, 15] }
                                        ]
                                    },
                                    options: { show_legend: true }
                                }
                            ]
                        }
                    ]
                }
            },

            full: {
                presentation: {
                    title: "2024å¹´åº¦å·¥ä½œæŠ¥å‘Š",
                    author: "é¡¹ç›®å›¢é˜Ÿ",
                    theme: {
                        primary_color: "#1a73e8",
                        secondary_color: "#ffffff",
                        font_family: "Microsoft YaHei"
                    },
                    slides: [
                        {
                            slide_id: 1,
                            slide_type: "title_slide",
                            background: { type: "color", value: "#1a73e8" },
                            elements: [
                                {
                                    element_type: "text",
                                    position: { x: 0.5, y: 2, width: 9, height: 1.2, unit: "inch" },
                                    content: "2024å¹´åº¦å·¥ä½œæŠ¥å‘Š",
                                    style: {
                                        font_size: 48,
                                        font_weight: "bold",
                                        color: "#ffffff",
                                        text_align: "center"
                                    }
                                },
                                {
                                    element_type: "text",
                                    position: { x: 0.5, y: 3.5, width: 9, height: 0.6, unit: "inch" },
                                    content: "é¡¹ç›®å›¢é˜Ÿ | 2024å¹´12æœˆ",
                                    style: {
                                        font_size: 20,
                                        color: "#ffffff",
                                        text_align: "center"
                                    }
                                }
                            ]
                        },
                        {
                            slide_id: 2,
                            slide_type: "content_slide",
                            elements: [
                                {
                                    element_type: "text",
                                    position: { x: 0.5, y: 0.3, width: 9, height: 0.7, unit: "inch" },
                                    content: "é¡¹ç›®æ¦‚è¿°",
                                    style: {
                                        font_size: 32,
                                        font_weight: "bold",
                                        color: "#1a73e8"
                                    }
                                },
                                {
                                    element_type: "list",
                                    position: { x: 0.5, y: 1.2, width: 4.2, height: 3.5, unit: "inch" },
                                    list_type: "bullet",
                                    items: [
                                        { level: 0, content: "å®Œæˆæ ¸å¿ƒåŠŸèƒ½å¼€å‘" },
                                        { level: 1, content: "ç”¨æˆ·ç®¡ç†æ¨¡å—" },
                                        { level: 1, content: "æ•°æ®åˆ†ææ¨¡å—" },
                                        { level: 0, content: "æ€§èƒ½ä¼˜åŒ–æå‡ 40%" },
                                        { level: 0, content: "ç”¨æˆ·æ»¡æ„åº¦ 95%" }
                                    ],
                                    style: {
                                        font_size: 18,
                                        bullet_color: "#1a73e8",
                                        line_spacing: 1.8
                                    }
                                },
                                {
                                    element_type: "shape",
                                    position: { x: 5.2, y: 1.2, width: 4.3, height: 3.2, unit: "inch" },
                                    shape_type: "rectangle",
                                    style: {
                                        fill_color: "#f0f4ff",
                                        stroke_color: "#1a73e8",
                                        stroke_width: 2,
                                        border_radius: 10
                                    }
                                },
                                {
                                    element_type: "text",
                                    position: { x: 5.5, y: 1.5, width: 3.8, height: 2.8, unit: "inch" },
                                    content: "æ ¸å¿ƒæˆæœ\n\nâœ“ äº¤ä»˜ 12 ä¸ªåŠŸèƒ½æ¨¡å—\nâœ“ å¤„ç† 500 ä¸‡+ æ•°æ®\nâœ“ æœåŠ¡ 10,000+ ç”¨æˆ·\nâœ“ ç³»ç»Ÿç¨³å®šæ€§ 99.9%",
                                    style: {
                                        font_size: 16,
                                        color: "#333333",
                                        line_height: 1.6
                                    }
                                }
                            ]
                        },
                        {
                            slide_id: 3,
                            elements: [
                                {
                                    element_type: "text",
                                    position: { x: 0.5, y: 0.3, width: 9, height: 0.7, unit: "inch" },
                                    content: "å­£åº¦ä¸šç»©æ•°æ®",
                                    style: { font_size: 32, font_weight: "bold", color: "#1a73e8" }
                                },
                                {
                                    element_type: "table",
                                    position: { x: 0.5, y: 1.1, width: 9, height: 2.5, unit: "inch" },
                                    structure: { rows: 5, columns: 5, has_header: true },
                                    style: {
                                        header_bg_color: "#1a73e8",
                                        header_text_color: "#ffffff",
                                        alternate_row_color: "#f5f8ff"
                                    },
                                    data: [
                                        { row: 0, is_header: true, cells: [
                                            { col: 0, content: "æŒ‡æ ‡" },
                                            { col: 1, content: "Q1" },
                                            { col: 2, content: "Q2" },
                                            { col: 3, content: "Q3" },
                                            { col: 4, content: "Q4" }
                                        ]},
                                        { row: 1, cells: [
                                            { col: 0, content: "è¥æ”¶(ä¸‡)" },
                                            { col: 1, content: "125" },
                                            { col: 2, content: "156" },
                                            { col: 3, content: "189" },
                                            { col: 4, content: "220" }
                                        ]},
                                        { row: 2, cells: [
                                            { col: 0, content: "ç”¨æˆ·æ•°" },
                                            { col: 1, content: "2,500" },
                                            { col: 2, content: "4,200" },
                                            { col: 3, content: "7,100" },
                                            { col: 4, content: "10,500" }
                                        ]},
                                        { row: 3, cells: [
                                            { col: 0, content: "è½¬åŒ–ç‡" },
                                            { col: 1, content: "3.2%" },
                                            { col: 2, content: "4.1%" },
                                            { col: 3, content: "4.8%" },
                                            { col: 4, content: "5.5%" }
                                        ]},
                                        { row: 4, cells: [
                                            { col: 0, content: "æ»¡æ„åº¦" },
                                            { col: 1, content: "88%" },
                                            { col: 2, content: "91%" },
                                            { col: 3, content: "94%" },
                                            { col: 4, content: "95%" }
                                        ]}
                                    ]
                                },
                                {
                                    element_type: "chart",
                                    position: { x: 0.5, y: 3.8, width: 9, height: 2.2, unit: "inch" },
                                    chart_type: "line",
                                    title: "",
                                    data: {
                                        labels: ["Q1", "Q2", "Q3", "Q4"],
                                        datasets: [
                                            { label: "è¥æ”¶è¶‹åŠ¿", values: [125, 156, 189, 220], color: "#1a73e8" }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            slide_id: 4,
                            background: { type: "color", value: "#1a73e8" },
                            elements: [
                                {
                                    element_type: "text",
                                    position: { x: 0.5, y: 2.2, width: 9, height: 1, unit: "inch" },
                                    content: "æ„Ÿè°¢è§‚çœ‹",
                                    style: {
                                        font_size: 48,
                                        font_weight: "bold",
                                        color: "#ffffff",
                                        text_align: "center"
                                    }
                                },
                                {
                                    element_type: "text",
                                    position: { x: 0.5, y: 3.5, width: 9, height: 0.5, unit: "inch" },
                                    content: "æœŸå¾…ä¸æ‚¨çš„è¿›ä¸€æ­¥åˆä½œ",
                                    style: {
                                        font_size: 20,
                                        color: "#ffffff",
                                        text_align: "center"
                                    }
                                }
                            ]
                        }
                    ]
                }
            }
        };

        // ===== å·¥å…·å‡½æ•° =====
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function setStatus(status, text) {
            const dot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            dot.className = `status-dot ${status}`;
            statusText.textContent = text;
        }

        function updatePreview() {
            const input = document.getElementById('jsonInput');
            const preview = document.getElementById('preview');
            const charCount = document.getElementById('charCount');
            const slideCount = document.getElementById('slideCount');

            charCount.textContent = `${input.value.length} å­—ç¬¦`;

            if (!input.value.trim()) {
                preview.textContent = 'ç­‰å¾…è¾“å…¥ JSON æ•°æ®...';
                slideCount.textContent = '0 é¡µå¹»ç¯ç‰‡';
                setStatus('', 'å‡†å¤‡å°±ç»ª');
                return;
            }

            try {
                const data = JSON.parse(input.value);
                preview.innerHTML = syntaxHighlight(JSON.stringify(data, null, 2));
                
                const slides = data.presentation?.slides || data.slides || [];
                slideCount.textContent = `${slides.length} é¡µå¹»ç¯ç‰‡`;
                setStatus('valid', 'JSON æ ¼å¼æœ‰æ•ˆ');
            } catch (e) {
                preview.textContent = `è§£æé”™è¯¯: ${e.message}`;
                slideCount.textContent = 'è§£æå¤±è´¥';
                setStatus('invalid', 'JSON æ ¼å¼é”™è¯¯');
            }
        }

        function syntaxHighlight(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                let cls = 'color: #b5cea8;'; // number
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'color: #9cdcfe;'; // key
                    } else {
                        cls = 'color: #ce9178;'; // string
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'color: #569cd6;'; // boolean
                } else if (/null/.test(match)) {
                    cls = 'color: #569cd6;'; // null
                }
                return '<span style="' + cls + '">' + match + '</span>';
            });
        }

        // ===== æŒ‰é’®åŠŸèƒ½ =====
        function validateJSON() {
            const input = document.getElementById('jsonInput').value;
            if (!input.trim()) {
                showToast('è¯·å…ˆè¾“å…¥ JSON æ•°æ®', 'error');
                return false;
            }
            try {
                const data = JSON.parse(input);
                if (!data.presentation && !data.slides) {
                    showToast('JSON æœ‰æ•ˆï¼Œä½†ç¼ºå°‘ presentation æˆ– slides å­—æ®µ', 'error');
                    return false;
                }
                showToast('JSON æ ¼å¼éªŒè¯é€šè¿‡ï¼', 'success');
                return true;
            } catch (e) {
                showToast(`JSON æ ¼å¼é”™è¯¯: ${e.message}`, 'error');
                return false;
            }
        }

        function formatJSON() {
            const input = document.getElementById('jsonInput');
            try {
                const data = JSON.parse(input.value);
                input.value = JSON.stringify(data, null, 2);
                updatePreview();
                showToast('æ ¼å¼åŒ–å®Œæˆ', 'success');
            } catch (e) {
                showToast('JSON æ ¼å¼é”™è¯¯ï¼Œæ— æ³•æ ¼å¼åŒ–', 'error');
            }
        }

        function clearEditor() {
            document.getElementById('jsonInput').value = '';
            updatePreview();
            showToast('å·²æ¸…ç©º', 'info');
        }

        function showTemplates() {
            document.getElementById('templateModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('templateModal').classList.remove('show');
        }

        function loadTemplate(name) {
            const template = templates[name];
            if (template) {
                document.getElementById('jsonInput').value = JSON.stringify(template, null, 2);
                updatePreview();
                closeModal();
                showToast('æ¨¡æ¿åŠ è½½æˆåŠŸ', 'success');
            }
        }

        // ===== PPT ç”Ÿæˆæ ¸å¿ƒ =====
        async function generatePPT() {
            if (!validateJSON()) return;

            setStatus('processing', 'æ­£åœ¨ç”Ÿæˆ PPT...');

            try {
                const data = JSON.parse(document.getElementById('jsonInput').value);
                const pptData = data.presentation || data;
                
                // åˆ›å»º PPT å®ä¾‹
                const pptx = new PptxGenJS();
                
                // è®¾ç½®æ¼”ç¤ºæ–‡ç¨¿å±æ€§
                if (pptData.title) pptx.title = pptData.title;
                if (pptData.author) pptx.author = pptData.author;
                pptx.layout = 'LAYOUT_16x9';

                // å¤„ç†æ¯ä¸€é¡µå¹»ç¯ç‰‡
                const slides = pptData.slides || [];
                for (const slideData of slides) {
                    const slide = pptx.addSlide();
                    
                    // è®¾ç½®èƒŒæ™¯
                    if (slideData.background) {
                        if (slideData.background.type === 'color') {
                            slide.background = { color: slideData.background.value.replace('#', '') };
                        }
                    }

                    // å¤„ç†å…ƒç´ 
                    const elements = slideData.elements || [];
                    for (const element of elements) {
                        await renderElement(slide, element, pptData.theme);
                    }
                }

                // ç”Ÿæˆæ–‡ä»¶å
                const fileName = pptData.title ? 
                    `${pptData.title.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '_')}.pptx` : 
                    'presentation.pptx';

                // ä¸‹è½½
                await pptx.writeFile({ fileName });
                
                setStatus('valid', 'ç”Ÿæˆå®Œæˆ');
                showToast('PPT ç”ŸæˆæˆåŠŸï¼Œå·²å¼€å§‹ä¸‹è½½ï¼', 'success');
                document.getElementById('lastAction').textContent = `ä¸Šæ¬¡ç”Ÿæˆ: ${new Date().toLocaleTimeString()}`;

            } catch (e) {
                console.error(e);
                setStatus('invalid', 'ç”Ÿæˆå¤±è´¥');
                showToast(`ç”Ÿæˆå¤±è´¥: ${e.message}`, 'error');
            }
        }

        async function renderElement(slide, element, theme) {
            const pos = element.position || {};
            const style = element.style || {};
            
            // è½¬æ¢ä½ç½®ï¼ˆé»˜è®¤ä½¿ç”¨ inchï¼‰
            const x = pos.x || 0;
            const y = pos.y || 0;
            const w = pos.width || pos.w || 5;
            const h = pos.height || pos.h || 1;

            switch (element.element_type) {
                case 'text':
                    renderText(slide, element, x, y, w, h, style);
                    break;
                case 'image':
                    await renderImage(slide, element, x, y, w, h, style);
                    break;
                case 'table':
                    renderTable(slide, element, x, y, w, h);
                    break;
                case 'shape':
                    renderShape(slide, element, x, y, w, h, style);
                    break;
                case 'chart':
                    renderChart(slide, element, x, y, w, h);
                    break;
                case 'list':
                    renderList(slide, element, x, y, w, h, style);
                    break;
            }
        }

        function renderText(slide, element, x, y, w, h, style) {
            const textOptions = {
                x, y, w, h,
                fontSize: style.font_size || 18,
                fontFace: style.font_family || 'Microsoft YaHei',
                color: (style.color || '#333333').replace('#', ''),
                align: style.text_align || 'left',
                valign: 'top',
                wrap: true
            };

            if (style.font_weight === 'bold') textOptions.bold = true;
            if (style.font_style === 'italic') textOptions.italic = true;
            if (style.line_height) textOptions.lineSpacing = style.line_height * 100;

            slide.addText(element.content || '', textOptions);
        }

        async function renderImage(slide, element, x, y, w, h, style) {
            const content = element.content || {};
            let imagePath = content.value || content.url || content.src;
            
            if (!imagePath || content.source === 'ai_generate') {
                // å¦‚æœæ²¡æœ‰å›¾ç‰‡æˆ–éœ€è¦AIç”Ÿæˆï¼Œæ·»åŠ å ä½ç¬¦
                slide.addShape('rect', {
                    x, y, w, h,
                    fill: { color: 'F0F0F0' },
                    line: { color: 'CCCCCC', width: 1 }
                });
                slide.addText(content.alt_text || content.description || 'å›¾ç‰‡å ä½ç¬¦', {
                    x, y, w, h,
                    fontSize: 12,
                    color: '999999',
                    align: 'center',
                    valign: 'middle'
                });
                return;
            }

            try {
                const imgOptions = { x, y, w, h };
                
                if (imagePath.startsWith('data:')) {
                    imgOptions.data = imagePath;
                } else {
                    imgOptions.path = imagePath;
                }

                if (style.border_radius) imgOptions.rounding = true;

                slide.addImage(imgOptions);
            } catch (e) {
                console.warn('å›¾ç‰‡åŠ è½½å¤±è´¥:', e);
                slide.addShape('rect', {
                    x, y, w, h,
                    fill: { color: 'FFEEEE' },
                    line: { color: 'FF0000', width: 1 }
                });
            }
        }

        function renderTable(slide, element, x, y, w, h) {
            const data = element.data || [];
            const style = element.style || {};
            
            // æ„å»ºè¡¨æ ¼æ•°æ®
            const tableData = data.map(row => {
                return (row.cells || []).map(cell => ({
                    text: cell.content || '',
                    options: {
                        colspan: cell.colspan || 1,
                        rowspan: cell.rowspan || 1
                    }
                }));
            });

            if (tableData.length === 0) return;

            const tableOptions = {
                x, y, w, h,
                fontFace: 'Microsoft YaHei',
                fontSize: style.font_size || 12,
                color: '333333',
                border: { 
                    type: 'solid', 
                    pt: 1, 
                    color: (style.border_color || '#DDDDDD').replace('#', '') 
                },
                align: 'center',
                valign: 'middle'
            };

            // è®¾ç½®è¡¨å¤´æ ·å¼
            if (element.structure?.has_header && data.length > 0) {
                tableOptions.firstRow = {
                    fill: { color: (style.header_bg_color || '#1a73e8').replace('#', '') },
                    color: (style.header_text_color || '#FFFFFF').replace('#', ''),
                    bold: true
                };
            }

            // äº¤æ›¿è¡Œé¢œè‰²
            if (style.alternate_row_color) {
                tableOptions.rowAlt = {
                    fill: { color: style.alternate_row_color.replace('#', '') }
                };
            }

            slide.addTable(tableData, tableOptions);
        }

        function renderShape(slide, element, x, y, w, h, style) {
            const shapeTypes = {
                'rectangle': 'rect',
                'circle': 'ellipse',
                'ellipse': 'ellipse',
                'triangle': 'triangle',
                'arrow': 'rightArrow',
                'line': 'line'
            };

            const shapeType = shapeTypes[element.shape_type] || 'rect';
            
            const shapeOptions = {
                x, y, w, h,
                fill: { color: (style.fill_color || '#1a73e8').replace('#', '') }
            };

            if (style.stroke_color || style.stroke_width) {
                shapeOptions.line = {
                    color: (style.stroke_color || '#000000').replace('#', ''),
                    width: style.stroke_width || 1
                };
            }

            if (style.opacity !== undefined) {
                shapeOptions.fill.transparency = (1 - style.opacity) * 100;
            }

            slide.addShape(shapeType, shapeOptions);

            // å¤„ç†å½¢çŠ¶ä¸Šçš„æ–‡å­—
            if (element.text_overlay?.enabled && element.text_overlay.content) {
                slide.addText(element.text_overlay.content, {
                    x, y, w, h,
                    align: 'center',
                    valign: 'middle',
                    fontSize: element.text_overlay.style?.font_size || 14,
                    color: (element.text_overlay.style?.color || '#FFFFFF').replace('#', '')
                });
            }
        }

        function renderChart(slide, element, x, y, w, h) {
            const chartTypes = {
                'bar': 'bar',
                'line': 'line',
                'pie': 'pie',
                'doughnut': 'doughnut',
                'area': 'area'
            };

            const chartType = chartTypes[element.chart_type] || 'bar';
            const data = element.data || {};
            
            const chartData = (data.datasets || []).map((ds, idx) => ({
                name: ds.label || `æ•°æ® ${idx + 1}`,
                labels: data.labels || [],
                values: ds.values || []
            }));

            if (chartData.length === 0) return;

            const chartOptions = {
                x, y, w, h,
                chartColors: (data.datasets || []).map(ds => 
                    (ds.color || '#1a73e8').replace('#', '')
                ),
                showLegend: element.options?.show_legend !== false,
                legendPos: element.options?.legend_position || 'b'
            };

            if (element.title) {
                chartOptions.title = element.title;
                chartOptions.showTitle = true;
            }

            slide.addChart(pptx.ChartType[chartType] || pptx.ChartType.bar, chartData, chartOptions);
        }

        function renderList(slide, element, x, y, w, h, style) {
            const items = element.items || [];
            const listType = element.list_type || 'bullet';
            
            const textItems = items.map(item => ({
                text: item.content || '',
                options: {
                    bullet: listType === 'numbered' ? { type: 'number' } : { code: '2022' },
                    indentLevel: item.level || 0,
                    fontSize: style.font_size || 16,
                    color: (style.font_color || '#333333').replace('#', ''),
                    paraSpaceAfter: 6
                }
            }));

            slide.addText(textItems, {
                x, y, w, h,
                fontFace: 'Microsoft YaHei',
                valign: 'top'
            });
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('templateModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        // å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                generatePPT();
            }
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>
