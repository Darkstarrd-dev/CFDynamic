<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WinWeb å…¨æ ˆå¼€å‘ç»ˆææŒ‡å—</title>
    <style>
        :root {
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --primary: #2563eb;
            --worker-color: #f97316;
            --d1-color: #10b981;
            --danger: #ef4444;
            --code-bg: #1e293b;
            --text-code: #e2e8f0;
            --text-main: #334155;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; line-height: 1.6; background: var(--bg-color); color: var(--text-main); margin: 0; padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; }

        h1 { text-align: center; color: #0f172a; margin-bottom: 10px; }
        h2 {
            border-left: 5px solid var(--primary);
            padding-left: 15px;
            margin-top: 50px;
            color: #1e293b;
            background: #e2e8f0;
            padding: 10px 15px;
            border-radius: 0 8px 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* 1. æ¶æ„å›¾å®¹å™¨ */
        .diagram-container {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            text-align: center;
            overflow-x: auto;
        }
        svg { max-width: 100%; height: auto; }
        .path-flow { stroke-dasharray: 10; animation: flow 1s linear infinite; }
        @keyframes flow { to { stroke-dashoffset: -20; } }

        /* 2. æ¦‚å¿µå¡ç‰‡ */
        .concept-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .concept-card { background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-top: 4px solid #ccc; }
        .concept-card.worker { border-top-color: var(--worker-color); }
        .concept-card.d1 { border-top-color: var(--d1-color); }
        .concept-title { font-weight: bold; font-size: 1.1em; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }

        /* 3. é¢åº¦ä¸è­¦ç¤º */
        .quota-section { background: #fff; border: 1px solid #cbd5e1; border-radius: 12px; padding: 20px; }
        .quota-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 10px; }
        .quota-box { background: #f1f5f9; padding: 15px; border-radius: 8px; border-left: 4px solid #64748b; }
        .quota-box.warn { border-left-color: var(--danger); background: #fef2f2; }
        .limit-val { font-size: 1.4rem; font-weight: bold; color: #0f172a; display: block; margin: 5px 0; }
        .limit-scope { font-size: 0.85rem; color: #dc2626; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px; }

        /* 4. ç›®å½•ä¸ç»ˆç«¯æ¨¡æ‹Ÿ */
        .terminal { background: #1e293b; color: #e2e8f0; padding: 20px; border-radius: 8px; font-family: 'Consolas', monospace; margin-top: 15px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3); }
        .prompt { color: #10b981; }
        .cmd { color: #e2e8f0; }
        .comment { color: #64748b; font-style: italic; }
        .output { color: #94a3b8; display: block; margin-bottom: 10px; }

        /* 5. ä»£ç å—é€šç”¨ */
        pre { background: var(--code-bg); color: var(--text-code); padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 0.9rem; margin-top: 0; }
        .step-card { background: var(--card-bg); border-radius: 12px; padding: 25px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-left: 5px solid var(--primary); }
        .step-title { font-size: 1.25rem; font-weight: bold; color: #1e293b; margin-bottom: 15px; }

        /* Note Box */
        .note { background: #eff6ff; border: 1px solid #dbeafe; padding: 15px; border-radius: 6px; color: #1e40af; margin-top: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h1>WinWeb å…¨æ ˆå¼€å‘å®æˆ˜æ‰‹å†Œ (å®Œæ•´ç‰ˆ)</h1>
    <p style="text-align: center; color: #64748b;">Worker æ¶æ„åŸç† | å…è´¹é¢åº¦è¯¦è§£ | ç›®å½•ä¸åˆ›å»º | å‰ç«¯äº¤äº’</p>

    <!-- ========================== -->
    <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸç†ä¸æ¦‚å¿µ (ä¿ç•™) -->
    <!-- ========================== -->
    <h2>1. ç³»ç»Ÿæ¶æ„ä¸æ ¸å¿ƒæ¦‚å¿µ</h2>

    <div class="diagram-container">
        <h3 style="margin-top:0; color:#64748b;">å…¨å±€æ•°æ®æµå‘å›¾</h3>
        <svg width="800" height="320" viewBox="0 0 800 320" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                    <path d="M0,0 L0,6 L9,3 z" fill="#94a3b8" />
                </marker>
            </defs>
            <!-- 1. å‰ç«¯ -->
            <g transform="translate(50, 80)">
                <rect x="0" y="0" width="180" height="140" rx="8" fill="#eff6ff" stroke="#3b82f6" stroke-width="2"/>
                <text x="90" y="30" text-anchor="middle" font-weight="bold" fill="#1e3a8a">ä½ çš„ Windows ç½‘é¡µ</text>
                <text x="90" y="50" text-anchor="middle" font-size="12" fill="#64748b">CF Pages (å‰ç«¯)</text>
                <rect x="40" y="80" width="20" height="20" rx="2" fill="#3b82f6"/>
                <text x="90" y="95" font-size="11" fill="#3b82f6">åŒå‡»å›¾æ ‡</text>
                <text x="90" y="115" font-size="11" fill="#64748b">è§¦å‘ fetch()</text>
            </g>
            <!-- Flow 1 -->
            <path d="M230 150 L340 150" stroke="#cbd5e1" stroke-width="3"/>
            <path d="M230 150 L340 150" stroke="#3b82f6" stroke-width="3" class="path-flow"/>
            <text x="285" y="140" text-anchor="middle" font-size="11" fill="#64748b">å‘é€ JSON æ•°æ®</text>
            <!-- 2. Worker -->
            <g transform="translate(350, 60)">
                <rect x="0" y="0" width="160" height="180" rx="8" fill="#fff7ed" stroke="#f97316" stroke-width="2"/>
                <text x="80" y="30" text-anchor="middle" font-weight="bold" fill="#9a3412">Cloudflare Worker</text>
                <text x="80" y="50" text-anchor="middle" font-size="12" fill="#c2410c">åç«¯é€»è¾‘ä¸­å¿ƒ</text>
                <text x="80" y="100" text-anchor="middle" font-size="11" fill="#c2410c">æ¥æ”¶è¯·æ±‚ & SQLå¤„ç†</text>
            </g>
            <!-- Flow 2 -->
            <path d="M510 150 L620 150" stroke="#cbd5e1" stroke-width="3"/>
            <path d="M510 150 L620 150" stroke="#10b981" stroke-width="3" class="path-flow"/>
            <!-- 3. D1 DB -->
            <g transform="translate(630, 80)">
                <path d="M0,20 C0,0 120,0 120,20 L120,120 C120,140 0,140 0,120 Z" fill="#f0fdf4" stroke="#10b981" stroke-width="2"/>
                <ellipse cx="60" cy="20" rx="60" ry="20" fill="none" stroke="#10b981" stroke-width="2"/>
                <text x="60" y="70" text-anchor="middle" font-weight="bold" fill="#064e3b">CF D1 æ•°æ®åº“</text>
                <text x="60" y="90" text-anchor="middle" font-size="11" fill="#047857">å­˜å‚¨ç‚¹å‡»æ•°æ®</text>
            </g>
        </svg>
    </div>

    <div class="concept-grid">
        <div class="concept-card worker">
            <div class="concept-title"><span style="color:#f97316;">ğŸŸ </span> ä»€ä¹ˆæ˜¯ Worker?</div>
            <p><strong>å®ƒæ˜¯â€œä¸çŸ¥ç–²å€¦çš„äº‘ç«¯æœåŠ¡å‘˜â€ã€‚</strong></p>
            <p>Worker æ˜¯è¿è¡Œåœ¨ Cloudflare å…¨çƒç½‘ç»œä¸Šçš„ä»£ç ã€‚å®ƒä¸éœ€è¦æœåŠ¡å™¨å¼€æœºï¼Œåªæœ‰å½“ä½ çš„å›¾æ ‡è¢«ç‚¹å‡»æ—¶ï¼Œå®ƒæ‰ä¼šâ€œé†’æ¥â€æ‰§è¡Œä¸€ç¬é—´ï¼ˆæ¯”å¦‚ 10 æ¯«ç§’ï¼‰ï¼ŒæŠŠæ•°æ®å­˜å…¥æ•°æ®åº“ï¼Œç„¶åç»§ç»­ä¼‘çœ ã€‚</p>
        </div>
        <div class="concept-card d1">
            <div class="concept-title"><span style="color:#10b981;">ğŸŸ¢</span> ä»€ä¹ˆæ˜¯ D1?</div>
            <p><strong>å®ƒæ˜¯â€œäº‘ç«¯çš„ Excel è¡¨æ ¼â€ã€‚</strong></p>
            <p>D1 æ˜¯ Cloudflare æä¾›çš„ SQLite æ•°æ®åº“ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯å’Œ Worker é…åˆæå…¶ç´§å¯†ï¼Œè¯»å–é€Ÿåº¦å¿«ï¼Œè€Œä¸”éå¸¸ä¾¿å®œã€‚</p>
        </div>
    </div>

    <!-- ========================== -->
    <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šé¢åº¦ä¸è´¦æˆ· (æ–°å¢è¯¦è§£) -->
    <!-- ========================== -->
    <h2>2. å…è´¹é¢åº¦ä¸è´¦æˆ·è®¡ç®— (é‡ç‚¹)</h2>
    <div class="quota-section">
        <p>ä½ éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼šCloudflare çš„å…è´¹é¢åº¦é€šå¸¸æ˜¯<strong>åŸºäºè´¦æˆ· (Per Account)</strong> è®¡ç®—çš„ï¼Œè€Œä¸æ˜¯åŸºäºå•ä¸ª Worker æˆ–æ•°æ®åº“ã€‚</p>

        <div class="quota-grid">
            <!-- Worker é¢åº¦ -->
            <div class="quota-box warn">
                <div class="concept-title" style="color:#b91c1c;">âš¡ Workers é¢åº¦</div>
                <span class="limit-val">100,000 æ¬¡è¯·æ±‚ / å¤©</span>
                <span class="limit-scope">æ‰€æœ‰ Worker åˆè®¡</span>
                <p style="font-size:0.9rem; margin-top:10px;">
                    <strong>è§£é‡Šï¼š</strong> å¦‚æœä½ åˆ›å»ºäº† 2 ä¸ª Worker (Worker A å’Œ Worker B)ã€‚<br>
                    A ä»Šå¤©è·‘äº† 6 ä¸‡æ¬¡ï¼ŒB ä»Šå¤©è·‘äº† 5 ä¸‡æ¬¡ã€‚<br>
                    æ€»è®¡ 11 ä¸‡æ¬¡ -> <strong>ä½ ä¼šè¶…é¢</strong>ï¼ˆé€šå¸¸ä¼šæŠ¥é”™åœæ­¢æœåŠ¡ï¼Œç›´åˆ°ç¬¬äºŒå¤©é‡ç½®ï¼‰ã€‚
                </p>
            </div>

            <!-- D1 é¢åº¦ -->
            <div class="quota-box warn">
                <div class="concept-title" style="color:#047857;">ğŸ’¾ D1 æ•°æ®åº“é¢åº¦</div>
                <span class="limit-val">500 ä¸‡æ¬¡è¯»å– / æœˆ</span>
                <span class="limit-scope">æ‰€æœ‰æ•°æ®åº“åˆè®¡</span>
                <p style="font-size:0.9rem; margin-top:10px;">
                    <strong>è§£é‡Šï¼š</strong> ä½ å¯ä»¥åˆ›å»ºå¤šä¸ªæ•°æ®åº“ï¼ˆä¾‹å¦‚ 10 ä¸ªï¼‰ã€‚<br>
                    ä½†æ‰€æœ‰æ•°æ®åº“è¢« Worker è¯»å–çš„æ€»è¡Œæ•°ï¼Œä¸€ä¸ªæœˆåŠ èµ·æ¥ä¸èƒ½è¶…è¿‡ 500 ä¸‡è¡Œã€‚<br>
                    å†™å…¥ï¼ˆWriteï¼‰é™åˆ¶æ˜¯æ¯å¤© 10 ä¸‡æ¬¡ã€‚
                </p>
            </div>
        </div>
        <div class="note">
            <strong>å®é™…ä½“éªŒï¼š</strong> å¯¹äºä¸ªäººåšå®¢æˆ– Windows æ¨¡æ‹Ÿç½‘é¡µï¼Œè¾¾åˆ° 10 ä¸‡æ¬¡/å¤©æ„å‘³ç€ä½ æœ‰æ•°åƒåæ´»è·ƒç”¨æˆ·åœ¨ç–¯ç‹‚ç‚¹å‡»ã€‚æ—¥å¸¸ä½¿ç”¨å‡ ä¹ä¸éœ€è¦æ‹…å¿ƒè¶…é¢ã€‚
        </div>
    </div>

    <!-- ========================== -->
    <!-- ç¬¬ä¸‰éƒ¨åˆ†ï¼šç›®å½•ç»“æ„ä¸åˆ›å»º (è§£ç­”æ“ä½œç–‘é—®) -->
    <!-- ========================== -->
    <h2>3. ç›®å½•ç»“æ„ä¸ Worker åˆ›å»ºå®æ“</h2>

    <div class="step-card">
        <div class="step-title">å¦‚ä½•åœ¨æœ¬åœ°åˆ›å»º Workerï¼Ÿ</div>
        <p><strong>Q: æˆ‘åœ¨å“ªä¸ªç›®å½•ä¸‹è¿è¡Œåˆ›å»ºå‘½ä»¤ï¼Ÿ</strong></p>
        <p>A: åœ¨ä½ çš„<strong>æ€»é¡¹ç›®æ ¹ç›®å½•</strong>ä¸‹è¿è¡Œã€‚è¯¥å‘½ä»¤ä¼šè‡ªåŠ¨ä¸ºä½ åˆ›å»ºä¸€ä¸ªæ–°çš„å­æ–‡ä»¶å¤¹ã€‚</p>

        <div class="terminal">
            <span class="comment"># 1. å‡è®¾ä½ ç°åœ¨ä½äºæ€»ç›®å½• (WinWeb-Project)</span><br>
            <span class="prompt">user@pc:~/WinWeb-Project$</span> ls<br>
            <span class="output">frontend/  README.md</span><br>
            <br>
            <span class="comment"># 2. è¿è¡Œåˆ›å»ºå‘½ä»¤ (backend æ˜¯ä½ æƒ³è¦ç»™ Worker æ–‡ä»¶å¤¹èµ·çš„åå­—)</span><br>
            <span class="prompt">user@pc:~/WinWeb-Project$</span> <span class="cmd">npm create cloudflare@latest backend</span><br>
            <br>
            <span class="output">
            > In which directory do you want to create your application?<br>
            > Using: /WinWeb-Project/backend <span class="comment">(å®ƒä¼šè‡ªåŠ¨æ£€æµ‹å¹¶åˆ›å»ºè¿™ä¸ªæ–‡ä»¶å¤¹)</span><br>
            > What type of application do you want to create?<br>
            > "Hello World" Worker <span class="comment">(é€‰æ‹©è¿™ä¸ª)</span>
            </span><br>
            <br>
            <span class="comment"># 3. åˆ›å»ºå®Œæˆåï¼Œä½ ä¼šå‘ç°å¤šäº†ä¸€ä¸ªæ–‡ä»¶å¤¹</span><br>
            <span class="prompt">user@pc:~/WinWeb-Project$</span> ls<br>
            <span class="output">frontend/  backend/  README.md</span>
        </div>

        <div class="note">
            <strong>Q: å¦‚æœæˆ‘æƒ³åšç¬¬äºŒä¸ª Worker æ€ä¹ˆåŠï¼Ÿ</strong><br>
            å¾ˆç®€å•ï¼Œå†æ¬¡åœ¨æ ¹ç›®å½•è¿è¡Œå‘½ä»¤ï¼Œæ¢ä¸ªåå­—å³å¯ï¼š<br>
            <code>npm create cloudflare@latest another-worker</code><br>
            è¿™æ ·ä½ çš„ç›®å½•ä¸‹å°±ä¼šæœ‰ï¼š<code>frontend/</code>, <code>backend/</code>, <code>another-worker/</code>ã€‚å®ƒä»¬æ˜¯å¹³çº§çš„ã€‚
        </div>
    </div>

    <!-- ========================== -->
    <!-- ç¬¬å››éƒ¨åˆ†ï¼šå‰ç«¯åŸ‹ç‚¹ (ä¿ç•™) -->
    <!-- ========================== -->
    <h2>4. å‰ç«¯åŸ‹ç‚¹ (Track Visit)</h2>
    <div class="step-card">
        <div class="step-title">è®©ä½ çš„ Windows å›¾æ ‡ä¼šâ€œè¯´è¯â€</div>
        <p>å°†æ­¤ä»£ç ä¿å­˜ä¸º <code>js/analytics.js</code> å¹¶åœ¨æ‰€æœ‰é¡µé¢å¼•ç”¨ã€‚</p>
        <pre><code>async function trackVisit(appId) {
    // è¿™é‡Œçš„ URL æ˜¯ä½ å‘å¸ƒ Worker åè·å¾—çš„ (npx wrangler deploy åä¼šæ˜¾ç¤º)
    const workerUrl = 'https://my-stats.ä½ çš„å.workers.dev/visit';

    try {
        await fetch(workerUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            // å‘é€ç®€å•çš„ JSON: { appId: 'calculator' }
            body: JSON.stringify({ appId: appId })
        });
        console.log(`[ç»Ÿè®¡æˆåŠŸ] ${appId} +1`);
    } catch (err) {
        console.error('[ç»Ÿè®¡å¤±è´¥] å¯èƒ½æ˜¯ç½‘ç»œæ‹¦æˆªæˆ– Worker é¢åº¦è€—å°½', err);
    }
}

// è‡ªåŠ¨æ‰§è¡Œï¼šå¦‚æœæ˜¯éšè—é¡µé¢ï¼ˆå¦‚ game.htmlï¼‰ï¼Œè‡ªåŠ¨æ±‡æŠ¥
if (window.location.pathname.includes('.html')) {
    const pageName = window.location.pathname.split('/').pop();
    trackVisit(pageName);
}</code></pre>
        <p><strong>HTML è°ƒç”¨ç¤ºä¾‹ï¼š</strong></p>
        <pre><code>&lt;!-- å›¾æ ‡ç‚¹å‡» (åŒå‡») --&gt;
&lt;div class="icon" ondblclick="trackVisit('calculator'); window.open('calc.html')"&gt;...&lt;/div&gt;

&lt;!-- èœå•ç‚¹å‡» (å•å‡») --&gt;
&lt;div class="menu-item" onclick="trackVisit('calculator');"&gt;æ‰“å¼€è®¡ç®—å™¨&lt;/div&gt;</code></pre>
    </div>

    <!-- ========================== -->
    <!-- ç¬¬äº”éƒ¨åˆ†ï¼šæ•°æ®å±•ç¤º (ä¿ç•™) -->
    <!-- ========================== -->
    <h2>5. æ•°æ®è¯»å–ä¸å¯è§†åŒ–æ¸²æŸ“</h2>
    <div class="step-card" style="border-left-color: #10b981;">
        <div class="step-title">åˆ¶ä½œâ€œå…³äºæœ¬æœºâ€çš„ç»Ÿè®¡é¢æ¿</div>
        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 300px;">
                <strong>Worker ç«¯ (åç«¯è¯»å–):</strong>
                <pre><code>// åœ¨ Worker ä»£ç ä¸­å¤„ç† GET /stats
if (url.pathname === '/stats') {
  const result = await env.DB.prepare(
    "SELECT * FROM analytics ORDER BY hits DESC"
  ).all();
  return Response.json(result.results);
}</code></pre>
            </div>
            <div style="flex: 1; min-width: 300px;">
                <strong>ç½‘é¡µç«¯ (å‰ç«¯æ¸²æŸ“):</strong>
                <pre><code>async function showStats() {
  const res = await fetch('.../stats');
  const data = await res.json();
  // data = [{app_id:'calc', hits:50}, ...]

  const list = document.getElementById('list');
  list.innerHTML = data.map(item =>
    `&lt;li&gt;${item.app_id}: ${item.hits}&lt;/li&gt;`
  ).join('');
}</code></pre>
            </div>
        </div>
    </div>

</div>

</body>
</html>
