<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WinWeb å…¨æ ˆå¼€å‘å®æˆ˜æ‰‹å†Œ (ç»ˆæèåˆç‰ˆ)</title>
    <style>
        :root {
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --primary: #3b82f6;
            --accent: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --worker-color: #f97316;
            --code-bg: #1e293b;
            --text-code: #e2e8f0;
            --text-main: #334155;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; line-height: 1.6; background: var(--bg-color); color: var(--text-main); margin: 0; padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; }

        h1 { text-align: center; color: #0f172a; margin-bottom: 10px; }
        h2 {
            border-left: 5px solid var(--primary);
            padding-left: 15px;
            margin-top: 50px;
            color: #1e293b;
            background: #e2e8f0;
            padding: 12px 15px;
            border-radius: 0 8px 8px 0;
        }

        /* æ¶æ„å›¾å®¹å™¨ (ä¿ç•™ V4) */
        .diagram-container {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            text-align: center;
            overflow-x: auto;
        }
        svg { max-width: 100%; height: auto; }
        .path-flow { stroke-dasharray: 10; animation: flow 1s linear infinite; }
        @keyframes flow { to { stroke-dashoffset: -20; } }

        /* æ¦‚å¿µå¡ç‰‡ (ä¿ç•™ V4) */
        .concept-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .concept-card { background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-top: 4px solid #ccc; }
        .concept-card.worker { border-top-color: var(--worker-color); }
        .concept-title { font-weight: bold; font-size: 1.1em; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }

        /* é¢åº¦ä¸è­¦ç¤º (ä¿ç•™ V4) */
        .quota-section { background: #fff; border: 1px solid #cbd5e1; border-radius: 12px; padding: 20px; margin-bottom: 30px; }
        .quota-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 10px; }
        .quota-box { background: #f1f5f9; padding: 15px; border-radius: 8px; border-left: 4px solid #64748b; }
        .quota-box.warn { border-left-color: var(--danger); background: #fef2f2; }
        .limit-val { font-size: 1.4rem; font-weight: bold; color: #0f172a; display: block; margin: 5px 0; }
        .limit-scope { font-size: 0.85rem; color: #dc2626; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px; }

        /* ç›®å½•æ ‘ (ä¿ç•™ V3) */
        .file-tree { font-family: 'Consolas', monospace; white-space: pre; background: #1e293b; color: #e2e8f0; padding: 20px; border-radius: 8px; overflow-x: auto; }
        .tree-folder { color: #60a5fa; font-weight: bold; }
        .tree-file { color: #e2e8f0; }
        .tree-comment { color: #94a3b8; font-style: italic; }
        .card { background: var(--card-bg); border-radius: 12px; padding: 25px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        /* SQL è¡¨æ ¼ (ä¿ç•™ V3) */
        .sql-viz-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .sql-viz-table th { background: #e2e8f0; padding: 10px; text-align: left; border-bottom: 2px solid #94a3b8; }
        .sql-viz-table td { padding: 12px; border-bottom: 1px solid #cbd5e1; }
        .sql-type { font-family: monospace; color: var(--accent); background: #f3e8ff; padding: 2px 6px; border-radius: 4px; font-size: 0.9em; }
        .sql-key { font-weight: bold; color: var(--danger); }

        /* æ¸²æŸ“å¯¹ç…§ (ä¿ç•™ V3) */
        .render-flex { display: flex; align-items: flex-start; gap: 20px; flex-wrap: wrap; }
        .code-snippet { flex: 1; min-width: 300px; background: var(--code-bg); color: #e2e8f0; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.85rem; }
        .arrow-box { display: flex; align-items: center; justify-content: center; font-size: 2rem; color: var(--primary); padding: 20px 0; }
        .result-box { flex: 1; min-width: 300px; background: white; border: 2px solid var(--primary); border-radius: 8px; padding: 15px; min-height: 150px; }

        /* Q&A å¯¹æ¯”è¡¨ (æ–°å¢) */
        .qa-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .qa-table td, .qa-table th { border: 1px solid #cbd5e1; padding: 10px; vertical-align: top; }
        .qa-table th { background: #f1f5f9; text-align: left; }

        .note { background: #fff7ed; border-left: 4px solid #f97316; padding: 15px; margin-top: 15px; color: #9a3412; font-size: 0.95rem; }
    </style>
</head>
<body>

<div class="container">
    <h1>WinWeb å…¨æ ˆå¼€å‘æ‰‹å†Œ (V5 ç»ˆæç‰ˆ)</h1>
    <p style="text-align: center; color: #64748b;">èåˆæ¶æ„å¯è§†åŒ–ã€è¯¦ç»†ç›®å½•è§„èŒƒã€SQLåŸç†åŠæœ€æ–°ç–‘éš¾è§£ç­”</p>

    <!-- ========================================= -->
    <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šæ¶æ„å›¾ä¸æœåŠ¡è¯´æ˜ (ä¿ç•™ V4) -->
    <!-- ========================================= -->
    <h2>1. å…¨å±€æ¶æ„å¯è§†åŒ–</h2>
    <div class="diagram-container">
        <svg width="800" height="320" viewBox="0 0 800 320" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                    <path d="M0,0 L0,6 L9,3 z" fill="#94a3b8" />
                </marker>
            </defs>
            <!-- 1. å‰ç«¯ -->
            <g transform="translate(50, 80)">
                <rect x="0" y="0" width="180" height="140" rx="8" fill="#eff6ff" stroke="#3b82f6" stroke-width="2"/>
                <text x="90" y="30" text-anchor="middle" font-weight="bold" fill="#1e3a8a">CF Pages (å‰ç«¯)</text>
                <text x="90" y="50" text-anchor="middle" font-size="12" fill="#64748b">HTML/SVG/JS</text>
                <rect x="40" y="80" width="20" height="20" rx="2" fill="#3b82f6"/>
                <text x="90" y="95" font-size="11" fill="#3b82f6">åŒå‡»å›¾æ ‡</text>
            </g>
            <!-- Flow 1 -->
            <path d="M230 150 L340 150" stroke="#cbd5e1" stroke-width="3"/>
            <path d="M230 150 L340 150" stroke="#3b82f6" stroke-width="3" class="path-flow"/>
            <text x="285" y="140" text-anchor="middle" font-size="11" fill="#64748b">Fetch (JSON)</text>
            <!-- 2. Worker -->
            <g transform="translate(350, 60)">
                <rect x="0" y="0" width="160" height="180" rx="8" fill="#fff7ed" stroke="#f97316" stroke-width="2"/>
                <text x="80" y="30" text-anchor="middle" font-weight="bold" fill="#9a3412">CF Worker (åç«¯)</text>
                <text x="80" y="50" text-anchor="middle" font-size="12" fill="#c2410c">é€»è¾‘åˆ†å‘ä¸­å¿ƒ</text>
                <rect x="20" y="80" width="120" height="50" rx="4" fill="#fff" stroke="#fdba74"/>
                <text x="80" y="105" text-anchor="middle" font-size="10" fill="#c2410c">è·¯ç”±åˆ¤æ–­ (If/Else)</text>
                <text x="80" y="120" text-anchor="middle" font-size="9" fill="#9a3412">Visit? Or Stats?</text>
            </g>
            <!-- Flow 2 -->
            <path d="M510 150 L620 150" stroke="#cbd5e1" stroke-width="3"/>
            <path d="M510 150 L620 150" stroke="#10b981" stroke-width="3" class="path-flow"/>
            <!-- 3. D1 DB -->
            <g transform="translate(630, 80)">
                <path d="M0,20 C0,0 120,0 120,20 L120,120 C120,140 0,140 0,120 Z" fill="#f0fdf4" stroke="#10b981" stroke-width="2"/>
                <ellipse cx="60" cy="20" rx="60" ry="20" fill="none" stroke="#10b981" stroke-width="2"/>
                <text x="60" y="70" text-anchor="middle" font-weight="bold" fill="#064e3b">D1 æ•°æ®åº“</text>
                <text x="60" y="90" text-anchor="middle" font-size="11" fill="#047857">Tables (è¡¨)</text>
            </g>
        </svg>
    </div>

    <div class="concept-grid">
        <div class="concept-card worker">
            <div class="concept-title"><span style="color:#f97316;">ğŸŸ </span> ä»€ä¹ˆæ˜¯ Worker?</div>
            <p>å®ƒæ˜¯ä½ çš„â€œäº‘ç«¯æœåŠ¡å‘˜â€ã€‚å®ƒæ˜¯ä¸€æ®µä»£ç ï¼ŒæŒ‚åœ¨ Cloudflare çš„æœåŠ¡å™¨ä¸Šã€‚åªæœ‰å½“è¯·æ±‚æ¥çš„æ—¶å€™å®ƒæ‰è¿è¡Œï¼Œå¤„ç†å®Œç«‹åˆ»ä¼‘æ¯ã€‚ä¸éœ€è¦ä½ ç»´æŠ¤æœåŠ¡å™¨ã€‚</p>
        </div>
        <div class="concept-card d1" style="border-top-color: #10b981;">
            <div class="concept-title"><span style="color:#10b981;">ğŸŸ¢</span> ä»€ä¹ˆæ˜¯ D1?</div>
            <p>å®ƒæ˜¯â€œäº‘ç«¯çš„æ•°æ®åº“â€ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆ Excelï¼Œä½† Worker å¯ä»¥æ¯«ç§’çº§åœ°è¯»å†™å®ƒã€‚å®ƒéå¸¸é€‚åˆå­˜è®¡æ•°å™¨ã€ç”¨æˆ·ä¿¡æ¯ç­‰ã€‚</p>
        </div>
    </div>

    <!-- ========================================= -->
    <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šé¢åº¦ä¸è´¦æˆ·è¯´æ˜ (ä¿ç•™ V4 + æ–°å¢è§£ç­”) -->
    <!-- ========================================= -->
    <h2>2. å…è´¹é¢åº¦ä¸å¤š Worker æœºåˆ¶ (é‡è¦)</h2>
    <div class="quota-section">
        <div class="quota-grid">
            <div class="quota-box warn">
                <div class="concept-title" style="color:#b91c1c;">âš¡ Workers å…±äº«é¢åº¦</div>
                <span class="limit-val">100,000 æ¬¡è¯·æ±‚ / å¤©</span>
                <span class="limit-scope">åŸºäºè´¦æˆ· (Account Wide)</span>
            </div>
            <div class="quota-box warn">
                <div class="concept-title" style="color:#047857;">ğŸ’¾ D1 æ•°æ®åº“é¢åº¦</div>
                <span class="limit-val">500 ä¸‡æ¬¡è¯»å– / æœˆ</span>
                <span class="limit-scope">åŸºäºè´¦æˆ· (Account Wide)</span>
            </div>
        </div>

        <div class="note">
            <strong>Q: å¦‚æœæˆ‘å»ºäº†ä¸¤ä¸ª Worker (Worker A å’Œ Worker B)ï¼Œé¢åº¦æ€ä¹ˆç®—ï¼Ÿ</strong><br>
            A: å®ƒä»¬<strong>å…±äº«</strong>è¿™ 10 ä¸‡æ¬¡ã€‚ä¾‹å¦‚ A ç”¨äº† 5 ä¸‡ï¼ŒB ç”¨äº† 5 ä¸‡ï¼Œä½ çš„è´¦æˆ·ä»Šå¤©é¢åº¦å°±ç”¨å®Œäº†ã€‚<br>
            <br>
            <strong>Q: ç¬¬äºŒä¸ª Worker å¿…é¡»åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸‹å—ï¼Ÿ</strong><br>
            A: ä¸éœ€è¦ã€‚ä½ å¯ä»¥åœ¨ç”µè„‘çš„ä»»ä½•ä½ç½®ï¼ˆä¾‹å¦‚ `D:\ProjectA` å’Œ `E:\ProjectB`ï¼‰åˆ†åˆ«åˆ›å»º Workerã€‚åªè¦ä½ ç™»å½•çš„æ˜¯åŒä¸€ä¸ª CF è´¦å·ï¼Œå®ƒä»¬å°±éƒ½å±äºä½ ã€‚
        </div>
    </div>

    <!-- ========================================= -->
    <!-- ç¬¬ä¸‰éƒ¨åˆ†ï¼šç›®å½•ç»“æ„ä¸å‘å¸ƒ (ä¿ç•™ V3) -->
    <!-- ========================================= -->
    <h2>3. ç›®å½•ç»“æ„ï¼šGit ä¸å‘å¸ƒé€»è¾‘</h2>
    <div class="card">
        <p>æ¨èä½¿ç”¨â€œåŒæ–‡ä»¶å¤¹â€ç»“æ„ã€‚æ¨é€åˆ° GitHub æ—¶æ¨é€æ•´ä¸ªæ ¹ç›®å½•ã€‚</p>
        <div class="file-tree">
My-Windows-Project/          <span class="tree-comment">&lt;--- Git ä»“åº“æ ¹ç›®å½•</span>
â”‚
â”œâ”€â”€ <span class="tree-folder">frontend/</span>                <span class="tree-comment">&lt;--- 1. é™æ€ç½‘é¡µ (Pages)</span>
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ js/
â”‚       â””â”€â”€ analytics.js     <span class="tree-comment">&lt;--- åŸ‹ç‚¹ä»£ç æ”¾è¿™é‡Œ</span>
â”‚
â””â”€â”€ <span class="tree-folder">backend/</span>                 <span class="tree-comment">&lt;--- 2. åç«¯ä»£ç  (Worker)</span>
    â”œâ”€â”€ wrangler.toml        <span class="tree-comment">&lt;--- é…ç½®æ–‡ä»¶</span>
    â””â”€â”€ src/
        â””â”€â”€ index.js         <span class="tree-comment">&lt;--- é€»è¾‘æ ¸å¿ƒ</span>
        </div>
        <p>
            <strong>å‘å¸ƒæ–¹å¼ï¼š</strong><br>
            1. <strong>å‰ç«¯ï¼š</strong> `git push` åï¼ŒCF Pages è‡ªåŠ¨æŠ“å– `frontend` ç›®å½•å‘å¸ƒã€‚<br>
            2. <strong>åç«¯ï¼š</strong> åœ¨ `backend` ç›®å½•å†…ï¼Œæ‰“å¼€ç»ˆç«¯è¿è¡Œ `npx wrangler deploy`ã€‚
        </p>
    </div>

    <!-- ========================================= -->
    <!-- ç¬¬å››éƒ¨åˆ†ï¼šSQL ç»“æ„è¯¦è§£ (ä¿ç•™ V3) -->
    <!-- ========================================= -->
    <h2>4. æ•°æ®åº“ç»“æ„ï¼šSQL åŸç†</h2>
    <div class="card">
        <p>SQL è¯­å¥å…¶å®å°±æ˜¯å®šä¹‰è¡¨æ ¼è§„åˆ™çš„è¯­è¨€ã€‚</p>
        <table class="sql-viz-table">
            <thead>
                <tr>
                    <th>å­—æ®µå</th>
                    <th>ç±»å‹</th>
                    <th>å…³é”®è¯</th>
                    <th>é€šä¿—è§£é‡Š</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>app_id</strong></td>
                    <td><span class="sql-type">TEXT</span></td>
                    <td><span class="sql-key">PRIMARY KEY</span></td>
                    <td>
                        <strong>ä¸»é”® (èº«ä»½è¯)</strong>ã€‚<br>
                        ç¡®ä¿ 'calculator' è¿™ä¸ªåå­—åœ¨è¡¨é‡Œåªæœ‰ä¸€è¡Œã€‚å¦‚æœé‡å¤æ’å…¥ï¼Œæ•°æ®åº“ä¼šæŠ¥é”™æˆ–æŒ‰æŒ‡ä»¤æ›´æ–°å®ƒã€‚
                    </td>
                </tr>
                <tr>
                    <td><strong>hits</strong></td>
                    <td><span class="sql-type">INTEGER</span></td>
                    <td><span class="sql-key">DEFAULT 0</span></td>
                    <td>
                        <strong>è®¡æ•°å™¨</strong>ã€‚<br>
                        æ–°åˆ›å»ºåº”ç”¨æ—¶ï¼Œé»˜è®¤ç‚¹å‡»æ•°ä¸º 0ã€‚
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- ========================================= -->
    <!-- ç¬¬äº”éƒ¨åˆ†ï¼šWorker è¿›é˜¶è§£ç­” (æ–°å¢å†…å®¹) -->
    <!-- ========================================= -->
    <h2>5. Worker æœºåˆ¶ç–‘éš¾è§£ç­”</h2>
    <div class="card">
        <h3>Q1: ä¸ºä»€ä¹ˆè¦åœ¨ä¸€ä¸ªé¡¹ç›®é‡Œå»ºä¸¤ä¸ª Workerï¼Ÿ</h3>
        <p>é€šå¸¸æƒ…å†µä¸‹ï¼Œ<strong>ä½ ä¸éœ€è¦å»ºç«‹ä¸¤ä¸ª Worker</strong>ã€‚ä¸€ä¸ª Worker è¶³å¤Ÿå¼ºå¤§ï¼Œå¯ä»¥é€šè¿‡â€œè·¯ç”±â€å¤„ç†å¤šç§ä»»åŠ¡ã€‚</p>

        <div style="background:#f1f5f9; padding:15px; border-radius:8px;">
            <strong>ä»£ç æ¼”ç¤ºï¼šä¸€ä¸ª Worker åˆ†é¥°ä¸¤è§’</strong>
            <pre style="margin-top:5px;"><code>export default {
  async fetch(request, env) {
    const url = new URL(request.url);

    // ä»»åŠ¡ A: è®°å½•è®¿é—®
    if (url.pathname === '/visit') {
        return handleVisit(request, env);
    }

    // ä»»åŠ¡ B: è¯»å–ç»Ÿè®¡æ•°æ®
    if (url.pathname === '/stats') {
        return handleStats(env);
    }

    return new Response("æœªçŸ¥æŒ‡ä»¤", { status: 404 });
  }
}</code></pre>
        </div>
        <p><strong>ç»“è®ºï¼š</strong> é™¤éä½ è¦åšä¸¤ä¸ªå®Œå…¨ä¸ç›¸å¹²çš„é¡¹ç›®ï¼ˆæ¯”å¦‚ä¸€ä¸ªæ˜¯â€œWindowsç½‘é¡µâ€ï¼Œä¸€ä¸ªæ˜¯â€œå¾®ä¿¡æœºå™¨äººâ€ï¼‰ï¼Œå¦åˆ™å°½é‡ç”¨ä¸€ä¸ª Worker æ–¹ä¾¿ç®¡ç†ã€‚</p>

        <h3 style="margin-top:30px;">Q2: Worker å’Œ Pages Functions æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
        <table class="qa-table">
            <tr>
                <th>ç‰¹æ€§</th>
                <th>Standalone Worker (æ¨è)</th>
                <th>Pages Functions</th>
            </tr>
            <tr>
                <td><strong>ä½ç½®</strong></td>
                <td>ç‹¬ç«‹æ–‡ä»¶å¤¹ï¼Œç‹¬ç«‹é…ç½®</td>
                <td>æ”¾åœ¨ Pages é¡¹ç›®çš„ <code>/functions</code> ç›®å½•ä¸‹</td>
            </tr>
            <tr>
                <td><strong>åŸŸå</strong></td>
                <td>ç‹¬ç«‹åŸŸå (xx.workers.dev)</td>
                <td>è·Ÿéšç½‘ç«™ (yoursite.com/api/xx)</td>
            </tr>
            <tr>
                <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
                <td>é€šç”¨ APIï¼Œè§£è€¦ï¼Œå¯ç»™å¤šä¸ªç½‘ç«™ç”¨</td>
                <td>ç®€å•çš„å…¨æ ˆåº”ç”¨ï¼Œç”šè‡³ä¸éœ€è¦é…ç½® Git</td>
            </tr>
        </table>
    </div>

    <!-- ========================================= -->
    <!-- ç¬¬å…­éƒ¨åˆ†ï¼šå‰ç«¯æ¸²æŸ“å®æˆ˜ (ä¿ç•™ V3) -->
    <!-- ========================================= -->
    <h2>6. å®æˆ˜ï¼šå¦‚ä½•æŠŠæ•°æ®ç”»åœ¨ç½‘é¡µä¸Š</h2>
    <div class="card">
        <p>è¿™æ˜¯ä¸€ä¸ªâ€œå·¦æ‰‹æ‹¿æ•°æ®ï¼Œå³æ‰‹ç”»è¡¨æ ¼â€çš„è¿‡ç¨‹ã€‚</p>
        <div class="render-flex">
            <!-- ä»£ç éƒ¨åˆ† -->
            <div class="code-snippet">
                <div style="color:#94a3b8; margin-bottom:10px;">// js/stats.js</div>
async function loadStats() {
  // 1. å‘ Worker è¦æ•°æ®
  const res = await fetch('https://ä½ çš„worker/stats');
  const data = await res.json();

  // data = [{app_id: 'calc', hits: 10}, ...]

  // 2. ç”Ÿæˆ HTML
  const list = document.getElementById('rank-list');
  data.forEach(item => {
    list.innerHTML += `
      &lt;li&gt;
        ${item.app_id}:
        &lt;b&gt;${item.hits} æ¬¡&lt;/b&gt;
      &lt;/li&gt;
    `;
  });
}
            </div>

            <!-- è§†è§‰è½¬æ¢ -->
            <div class="arrow-box">â</div>

            <!-- ç»“æœéƒ¨åˆ† -->
            <div class="result-box">
                <h4 style="margin-top:0;">ğŸ“Š çƒ­åº¦æ’è¡Œ</h4>
                <ul id="rank-list" style="padding-left: 20px;">
                    <li>home-desktop: <b style="color:green">99 æ¬¡</b></li>
                    <li>calculator: <b style="color:green">10 æ¬¡</b></li>
                </ul>
                <button>åˆ·æ–°æ•°æ®</button>
            </div>
        </div>
    </div>

</div>

</body>
</html>
